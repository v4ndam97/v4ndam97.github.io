<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>LODISNA – Transport Operations Simulator</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="description" content="LODISNA-inspired transport operations simulator: 5 Spanish-plated trucks, international drivers, incidents, and Power BI-ready CSV export." />

<style>
  :root{
    --bg1:#f6f8ff;
    --bg2:#ffffff;
    --card:#ffffff;
    --text:#0f172a;
    --muted:rgba(15,23,42,.68);
    --border:rgba(15,23,42,.12);
    --shadow:0 18px 40px rgba(15,23,42,.10);
    --blue:#2563eb;
    --red:#ef4444;
    --radius:18px;
    --max:1140px;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
    color:var(--text);
    background:
      radial-gradient(1000px 650px at 10% 10%, rgba(37,99,235,.15), transparent 60%),
      radial-gradient(900px 650px at 90% 10%, rgba(239,68,68,.14), transparent 60%),
      linear-gradient(180deg,var(--bg1),var(--bg2));
    line-height:1.5;
  }
  a{color:inherit;text-decoration:none}
  a:hover{text-decoration:underline}
  .container{max-width:var(--max);margin:0 auto;padding:22px}

  .top{
    position:sticky;top:0;z-index:50;
    background:rgba(255,255,255,.88);
    backdrop-filter:blur(10px);
    border-bottom:1px solid var(--border);
  }
  .top-inner{display:flex;align-items:center;justify-content:space-between;gap:14px;flex-wrap:wrap}
  .brand{display:flex;align-items:center;gap:10px;font-weight:950;letter-spacing:-.3px}
  .dot{width:10px;height:10px;border-radius:999px;background:linear-gradient(135deg,var(--blue),var(--red));box-shadow:0 0 0 5px rgba(37,99,235,.12)}
  .sub{color:var(--muted);font-weight:800;font-size:.95rem;margin-top:2px}

  .card{
    background:var(--card);
    border:1px solid var(--border);
    border-radius:var(--radius);
    box-shadow:var(--shadow);
    padding:18px;
  }
  h1{margin:0 0 8px;font-size:clamp(1.9rem,3vw,2.6rem);letter-spacing:-.9px;line-height:1.1}
  h2{margin:0 0 10px;letter-spacing:-.4px}
  .muted{color:var(--muted)}
  .row{display:flex;align-items:baseline;justify-content:space-between;gap:10px;flex-wrap:wrap}

  .btn{
    display:inline-flex;align-items:center;justify-content:center;gap:10px;
    padding:12px 14px;border-radius:14px;border:1px solid var(--border);
    background:rgba(255,255,255,.85);
    font-weight:950;cursor:pointer;
    box-shadow:0 12px 26px rgba(15,23,42,.10);
    user-select:none;
    transition:transform .08s ease, background .2s ease, border-color .2s ease;
  }
  .btn:hover{background:rgba(15,23,42,.02);border-color:rgba(15,23,42,.18);text-decoration:none}
  .btn:active{transform:translateY(1px)}
  .btn.primary{background:linear-gradient(135deg,rgba(37,99,235,1),rgba(37,99,235,.82));border-color:rgba(37,99,235,.35);color:#fff}

  .kpis{display:grid;grid-template-columns:repeat(4,minmax(0,1fr));gap:12px;margin-top:12px}
  @media(max-width:980px){.kpis{grid-template-columns:1fr 1fr}}
  @media(max-width:560px){.kpis{grid-template-columns:1fr}}
  .kpi{
    border:1px solid rgba(15,23,42,.12);
    background:rgba(15,23,42,.02);
    border-radius:14px;
    padding:12px;
  }
  .kpi .k{color:rgba(15,23,42,.72);font-weight:950;font-size:.9rem}
  .kpi .v{font-weight:950;font-size:1.15rem;margin-top:6px}

  .searchRow{
    display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-top:12px
  }
  .searchRow input{
    flex:1 1 320px;
    padding:11px 12px;border-radius:12px;border:1px solid rgba(15,23,42,.16);
    background:#fff;outline:none;font-weight:800
  }

  .tableWrap{
    margin-top:12px;
    border-radius:14px;
    border:1px solid rgba(15,23,42,.12);
    overflow:auto;
    background:#fff;
  }
  table{width:100%;border-collapse:collapse;min-width:1200px}
  th,td{padding:10px;border-bottom:1px solid rgba(15,23,42,.08);font-size:.92rem;white-space:nowrap;text-align:left}
  th{position:sticky;top:0;background:#fff;color:rgba(15,23,42,.75);font-weight:950;z-index:2}
</style>
</head>

<body>
<header class="top">
  <div class="container top-inner">
    <div>
      <div class="brand"><span class="dot"></span> LODISNA – Transport Operations (Example)</div>
      <div class="sub">5 Spanish-plated trucks · international drivers · incidents · margin reporting</div>
    </div>
    <a class="btn" href="index.html">← Back</a>
  </div>
</header>

<main class="container">
  <section class="card">
    <div class="row">
      <h1>Example of my work at LODISNA</h1>
      <div style="display:flex;gap:10px;flex-wrap:wrap">
        <button class="btn primary" id="gen" type="button">Generate dataset</button>
        <button class="btn" id="dl" type="button">Download CSV</button>
      </div>
    </div>

    <p class="muted" style="margin:8px 0 0">
      Road freight operations example across Europe: double-driver assignments, delays/incidents, and cost/revenue/margin
      fields designed for KPI reporting.
    </p>

    <div class="searchRow">
      <input id="search" type="text" placeholder="Search driver, incident, pickup, delivery, plate, shipment..." />
      <button class="btn" id="onlyIncidents" type="button">Incidents only</button>
      <button class="btn" id="showAll" type="button">Show all</button>
    </div>

    <div class="kpis" id="kpis"></div>

    <div class="tableWrap">
      <table>
        <thead>
          <tr>
            <th>Shipment</th>
            <th>Date</th>
            <th>Truck Plate (ES)</th>
            <th>Trailer Plate (ES)</th>
            <th>Driver 1</th>
            <th>Driver 2</th>
            <th>Pickup</th>
            <th>Delivery</th>
            <th>KM</th>
            <th>Status</th>
            <th>Incident</th>
            <th>Revenue</th>
            <th>Cost</th>
            <th>Margin</th>
          </tr>
        </thead>
        <tbody id="tbody"></tbody>
      </table>
    </div>
  </section>
</main>

<script>
  const $ = (id) => document.getElementById(id);

  function mulberry32(seed){
    let a = seed >>> 0;
    return function(){
      a += 0x6D2B79F5;
      let t = Math.imul(a ^ (a >>> 15), 1 | a);
      t ^= t + Math.imul(t ^ (t >>> 7), 61 | t);
      return ((t ^ (t >>> 14)) >>> 0) / 4294967296;
    };
  }
  const pad = (n, w=4) => String(n).padStart(w,"0");
  const iso = (d) => d.toISOString().slice(0,10);
  const addDays = (isoDate, n) => { const d=new Date(isoDate); d.setDate(d.getDate()+n); return iso(d); };
  const eur = (n) => "€" + (Number.isFinite(n)?n:0).toFixed(2);

  const DRIVERS = [
    {name:"Aisha Khan", phone:"+44 7700 900221"},
    {name:"Noah Johnson", phone:"+1 415 555 0129"},
    {name:"Marek Nowak", phone:"+48 601 332 911"},
    {name:"Giulia Bianchi", phone:"+39 347 221 880"},
    {name:"Radu Ionescu", phone:"+40 721 456 700"},
    {name:"Yuki Tanaka", phone:"+81 70 1234 7788"},
    {name:"Omar Haddad", phone:"+971 50 712 3311"},
    {name:"Liam O'Connor", phone:"+353 86 234 7701"},
    {name:"Sofia Petrova", phone:"+359 88 773 2110"},
    {name:"Lucas Martin", phone:"+33 6 12 99 84 41"}
  ];

  const CITIES = ["Madrid","Barcelona","Valencia","Bilbao","Seville","Paris","Lyon","Brussels","Luxembourg","Frankfurt","Cologne","Hamburg","Munich","Milan","Turin","Vienna","Prague","Warsaw","Budapest","Bucharest","Amsterdam","Rotterdam"];
  const INCIDENTS = ["None","Traffic delay","Weather delay","Customs hold","Mechanical issue","Documentation issue","Customer slot missed"];

  function randomSpanishPlate(rnd){
    const letters="BCDFGHJKLMNPRSTVWXYZ";
    const n=Math.floor(1000 + rnd()*9000);
    const a=letters[Math.floor(rnd()*letters.length)];
    const b=letters[Math.floor(rnd()*letters.length)];
    const c=letters[Math.floor(rnd()*letters.length)];
    return `${n}-${a}${b}${c}`;
  }

  function downloadCSV(filename, rows){
    if(!rows || !rows.length){
      alert("Please generate data first.");
      return;
    }
    const headers = Object.keys(rows[0]);
    const lines = [headers.join(",")];
    for(const r of rows){
      const line = headers.map(h=>{
        const s = String(r[h] ?? "");
        if (s.includes(",") || s.includes('"') || s.includes("\n")) return `"${s.replaceAll('"','""')}"`;
        return s;
      }).join(",");
      lines.push(line);
    }
    const blob = new Blob([lines.join("\n")], {type:"text/csv;charset=utf-8"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = filename;
    a.click();
    URL.revokeObjectURL(url);
  }

  let ROWS = [];
  let incidentsOnly = false;

  function generate(){
    const seed = 97 + Math.floor(Math.random()*9999);
    const rnd = mulberry32(seed);

    // 5 trucks (each with trailer)
    const fleet = [];
    for(let i=1;i<=5;i++){
      fleet.push({
        truck_plate: randomSpanishPlate(rnd),
        trailer_plate: randomSpanishPlate(rnd)
      });
    }

    const horizon = 140;
    const start = (()=>{ const d=new Date(); d.setDate(d.getDate()-horizon); return iso(d); })();

    ROWS = [];
    const nShip = 90;

    for(let i=1;i<=nShip;i++){
      const sh = "SHP-LD-" + pad(i, 5);
      const date = addDays(start, Math.floor(rnd()*horizon));

      const f = fleet[Math.floor(rnd()*fleet.length)];
      const d1 = DRIVERS[Math.floor(rnd()*DRIVERS.length)];
      let d2 = DRIVERS[Math.floor(rnd()*DRIVERS.length)];
      if (d2.name === d1.name) d2 = DRIVERS[(DRIVERS.indexOf(d1)+1) % DRIVERS.length];

      const pickup = CITIES[Math.floor(rnd()*CITIES.length)];
      let delivery = CITIES[Math.floor(rnd()*CITIES.length)];
      while (delivery === pickup) delivery = CITIES[Math.floor(rnd()*CITIES.length)];

      const km = Math.round(320 + rnd()*1550);

      const lateProb = Math.min(0.30, 0.06 + (km>1100?0.07:0));
      const incident = (rnd()<0.22) ? INCIDENTS[Math.floor(rnd()*INCIDENTS.length)] : "None";
      const delayed = (! (rnd() > lateProb)) || incident !== "None";
      const status = delayed ? "Delayed" : "On time";

      const fuelLiters = km * (0.28 + rnd()*0.07);
      const fuelCost = fuelLiters * (1.55 + rnd()*0.35);
      const toll = km * (0.06 + rnd()*0.05);
      const labor = (km/70) * (30 + rnd()*10);
      const overhead = 55 + rnd()*45;

      const cost = fuelCost + toll + labor + overhead;
      const revenue = km * (1.10 + rnd()*0.35) + (rnd()*90);
      const margin = revenue - cost;

      ROWS.push({
        shipment_id: sh,
        date,
        truck_plate: f.truck_plate,
        trailer_plate: f.trailer_plate,
        driver_1: d1.name,
        driver_2: d2.name,
        pickup,
        delivery,
        km,
        status,
        incident,
        revenue: +revenue.toFixed(2),
        cost: +cost.toFixed(2),
        margin: +margin.toFixed(2)
      });
    }

    render();
  }

  function applySearch(rows){
    const q = ($("search").value || "").trim().toLowerCase();
    if(!q) return rows;

    return rows.filter(r => {
      const hay = [
        r.shipment_id, r.date, r.truck_plate, r.trailer_plate,
        r.driver_1, r.driver_2, r.pickup, r.delivery,
        r.status, r.incident
      ].join(" ").toLowerCase();
      return hay.includes(q);
    });
  }

  function render(){
    const total = ROWS.length || 1;
    const onTime = ROWS.filter(x => x.status === "On time").length;
    const delayed = ROWS.filter(x => x.status !== "On time").length;
    const inc = ROWS.filter(x => x.incident && x.incident !== "None").length;

    const rev = ROWS.reduce((a,x)=>a + x.revenue, 0);
    const cost = ROWS.reduce((a,x)=>a + x.cost, 0);
    const mar = rev - cost;

    $("kpis").innerHTML = `
      <div class="kpi"><div class="k">Shipments</div><div class="v">${total}</div></div>
      <div class="kpi"><div class="k">On time</div><div class="v">${onTime} (${Math.round(onTime/total*100)}%)</div></div>
      <div class="kpi"><div class="k">Incidents</div><div class="v">${inc}</div></div>
      <div class="kpi"><div class="k">Total margin</div><div class="v">${eur(mar)}</div></div>
    `;

    let rows = ROWS.slice().sort((a,b)=> (b.date||"").localeCompare(a.date||""));
    if (incidentsOnly) rows = rows.filter(x => x.incident && x.incident !== "None");
    rows = applySearch(rows);

    const body = $("tbody");
    body.innerHTML = "";
    rows.slice(0, 220).forEach(r=>{
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${r.shipment_id}</td>
        <td>${r.date}</td>
        <td>${r.truck_plate}</td>
        <td>${r.trailer_plate}</td>
        <td>${r.driver_1}</td>
        <td>${r.driver_2}</td>
        <td>${r.pickup}</td>
        <td>${r.delivery}</td>
        <td>${r.km}</td>
        <td>${r.status}</td>
        <td>${r.incident}</td>
        <td>${eur(r.revenue)}</td>
        <td>${eur(r.cost)}</td>
        <td>${eur(r.margin)}</td>
      `;
      body.appendChild(tr);
    });
  }

  $("gen").addEventListener("click", generate);
  $("dl").addEventListener("click", ()=>downloadCSV("lodisna_transport_dataset.csv", ROWS));

  $("onlyIncidents").addEventListener("click", ()=>{ incidentsOnly=true; render(); });
  $("showAll").addEventListener("click", ()=>{ incidentsOnly=false; render(); });
  $("search").addEventListener("input", render);

  generate();
</script>

</body>
</html>
